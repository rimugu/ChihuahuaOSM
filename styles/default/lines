# -------------------------------------------------------------------
# This is the default mkgmap style file for converting OSM ways
# into Garmin lines.
# Any line prefaced with # is a comment and will not be applied.
# Each line is a rule, of the generalised format:
# OSM_tag(s)_to_match [Garmin_type_code resolution]
# See http://wiki.openstreetmap.org/wiki/Mkgmap/help/style_rules	
# and http://wiki.openstreetmap.org/wiki/Mkgmap/help/Custom_styles
# for more information.

addr:housenumber=* {set mkgmap:execute_finalize_rules=true}

# Assign the street name for house number search
highway=* & name=* {set mkgmap:street='${name}'}

abandoned=* & abandoned!=no {name '${name} (abandoned)  [${abandoned}]' | '(abandoned)  [${abandoned}]'} 
#abandoned=yes {deletealltags} # old, depreciated, ambiguous, method of handling abandoned
#abandoned=yes {name '${name} (abandoned)' | '(abandoned)'}
#name=* {name '${name} [${ref|highway-symbol:"box:4:8"}|${alt_name}]' | '${name}'}
#location=underground {name '${name} (underground)' | '(underground)'}
# [0x0a continue with_actions]

# do these as lines regardless of being closed unless explicity marked as area. continue in case also a highway
aeroway=runway & area!=yes {name '${ref} [runway]' | '[runway]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x27 resolution 20-24 continue]
(aeroway=taxiway | aeroway=taxilane) & area!=yes {name '${ref} [taxiway]' | '[taxiway]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x27 resolution 22-24 continue]
aeroway=airstrip | abandoned=yes {name '${ref} (abandoned) [airstrip]' | '(abandoned) [airstrip]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x27 resolution 22-24 continue]
aeroway=airstrip | aeroway=aerodrome {name '${ref} [airstrip]' | '[airstrip]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x27 resolution 22-24 continue]

#aerialway=gondola | aerialway=cable_car | aerialway=chair_lift [0x1b resolution 22-24 default_name 'aerialway']
aerialway=gondola | aerialway=cable_car | aerialway=chair_lift {name '${ref} [aerialway]' | '[aerialway]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10403 resolution 22-24]
aerialway=zip_line | aerialway=zipline {name '${ref} [zipline]' | '[zipline]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10101 resolution 24]
highway=via_ferrata {name '${ref} [via_ferrata]' | '[via_ferrata]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10101 resolution 24]
highway=piste | highway=ski | piste:difficulty=* | piste:type=* | piste=* {name '${ref} [ski]' | '[ski]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10101 resolution 24]

# Mark highways with the toll flag
highway=* & (toll=yes | toll=true) {set mkgmap:toll=yes}

#To identify as tunnel labeling, railroad image of things to update

#bridge=* & highway=* {name '${name} [bridge]' | '[bridge]'} [0x0107 resolution 24 continue with_actions]
#highway=* & oneway=yes [0x10013 resolution 24 continue with_actions]

bridge=yes & highway=* {name '${name} [bridge]' | '[bridge]'} [0x10101 resolution 24 continue with_actions]
bridge=* & highway=* {name '${name} (${bridge}) [bridge]' | '(${bridge}) [bridge]'} [0x10101 resolution 24 continue with_actions]
(tunnel=yes | culvert=yes) & highway=* {name '${name} [tunnel]' | '[tunnel]'} [0x10101 resolution 24 continue with_actions]
(tunnel=* | culvert=*) & highway=* {name '${name} (${tunnel}) [tunnel]' | '${name} (${culvert}) [tunnel]' | '(${tunnel}) [tunnel]' | '(${culvert}) [tunnel]'} [0x10101 resolution 24 continue with_actions]
bridge=yes & railway=* {name '${name} [bridge]' | '[bridge]'} [0x14 resolution 24 continue with_actions]
bridge=* & railway=* {name '${name} (${bridge}) [bridge]' | '(${bridge}) [bridge]'} [0x14 resolution 24 continue with_actions]
(tunnel=yes | culvert=yes) & railway=* {name '${name} [tunnel]' | '[tunnel]'} [0x14 resolution 24 continue with_actions]
(tunnel=* | culvert=*) & railway=* {name '${name} (${tunnel}) [tunnel]' | '${name} (${culvert}) [tunnel]' | '(${tunnel}) [tunnel]' | '(${culvert}) [tunnel]'} 
	[0x14 resolution 24 continue with_actions]
(tunnel=yes | culvert=yes) & waterway=* {name '${name} [tunnel]' | '[tunnel]'} [0x26 resolution 24 continue with_actions]
(tunnel=* | culvert=*) & waterway=* {name '${name} (${tunnel}) [tunnel]' | '${name} (${culvert}) [tunnel]' | '(${tunnel}) [tunnel]' | '(${culvert}) [tunnel]'} 
	[0x26 resolution 24 continue with_actions]

# Hide proposed ways
highway=proposed | highway=proposal | highway=planned | highway~'.*proposed.*' {delete highway; delete junction}
# Hide removed ways
highway=razed | highway=dismantled | highway=disused | highway=demolished {delete highway; delete junction}
# Hide abandoned ways. Abandoned highways have some evidence of their former existence but are no longer used. These
# abandoned highways could be useful in topographical maps.
# https://wiki.openstreetmap.org/wiki/Key:abandoned:
#(abandoned:highway=* & (highway!=* | highway=yes)) | highway=abandoned {delete highway; delete junction}
# Hide other non-existent ways
highway=unbuilt | highway=neverbuilt | highway=rejected | highway~'x-.*' {delete highway; delete junction}
# Remove highway tag from ways which are not suitable for routing
highway=traffic_signals | highway=junction | highway=island | highway=centre_line | highway=traffic_island | highway=stopline |
highway=bus_stop | highway=bus_guideway | highway=emergency_access_point | highway=ohm:military:Trench
	{delete highway}
#highway=via_ferrata {delete highway} # this shouldn't show as routable on default map: path only for specialists
#highway=piste | highway=ski {delete highway}
highway=no | highway=none {delete highway}

# Disable dead-end-checks for unaccessible oneways
highway=* & oneway=yes & (access=private | access=no) {add mkgmap:dead-end-check=false}
# Validation-like checks (uncomment to enable)
#highway=motorway_link & oneway!=yes & (oneway!=no & oneway=*) {echo "motorway_link lacks oneway"}
highway=motorway | highway=motorway_link {add oneway=yes; add mkgmap:numbers=false}

# start of rules for process-exits and process-destination options
# which may add info to a part of these highway=*_link roads:
# motorway_link, trunk_link, primary_link, secondary_link, tertiary_link
# build destination hint
mkgmap:dest_hint=* {
 set tmp:dest_hint='${destination:ref|subst: =>} ${mkgmap:dest_hint|subst:;=> |subst:/=> }' |
 '${ref|subst: =>} ${mkgmap:dest_hint|subst:;=> |subst:/=> }' |
 '${mkgmap:dest_hint|subst:;=> |subst:/=> }';
 }
# build exit hint
mkgmap:exit_hint=true {
 set tmp:exit_hint='Exit ${mkgmap:exit_hint_ref} ${mkgmap:exit_hint_name}' |
 'Exit ${mkgmap:exit_hint_ref} ${mkgmap:exit_hint_exit_to}' |
 'Exit ${mkgmap:exit_hint_exit_to}' |
 'Exit ${mkgmap:exit_hint_name}' |
 'Exit ${mkgmap:exit_hint_ref}';
 }
# use destination hint and/or exit hint to build name
mkgmap:exit_hint=true | mkgmap:dest_hint=* {name '${tmp:exit_hint} ${tmp:dest_hint}' | '${tmp:dest_hint}' | '${tmp:exit_hint}'}
# end of rules for process-exits and process-destination options

# Flag paved roads
highway=* & (surface=asphalt | surface=paved | surface=sett |
 surface=concrete | surface=concrete:lanes | surface=concrete:plates |
 surface=paving_stones | surface=cobblestone |
 surface=cobblestone:flattened | surface=metal | surface=wood | surface=chipseal)
 {set mkgmap:unpaved=0 ; name '${name} (pav)' | '(pav)' }
highway=* & tracktype=grade1 & surface!=* {set mkgmap:unpaved=0}

# Flag unpaved roads.
highway=* & mkgmap:unpaved!=0 & (
 surface=* |
 mtb:scale=* |
 tracktype~'grade[2-6]')
 {add mkgmap:unpaved=1}
	#{add mkgmap:unpaved=1 ; name '${name} (unp)' | '(unp)' }
highway=* & (
 mtb:scale~'[2-6].' |
 sac_scale~'.*(mountain|alpine)_hiking' |
 sport=via_ferrata)
 {set mkgmap:unpaved=1}
	#{set mkgmap:unpaved=1 ; name '${name} (unp)' | '(unp)'}
(highway=bridleway | highway=path | highway=track) & mkgmap:unpaved!=0 {add mkgmap:unpaved=1 }
(highway=unsurfaced | highway=via_ferrata) {set mkgmap:unpaved=1}

highway=* & mkgmap:unpaved!=1 & smoothness~'.*(bad|horrible|impassable)' {add mkgmap:road-speed=-2}

# Good ways without relation
highway=* & mkgmap:fast_road!=* & (int_ref=* | network=e-road | network=AH | network=TAH | network=US:I | network=US:US)
 {add mkgmap:fast_road=yes}
# Not best for car routing
highway=* & (access=hov | hov=designated | oneway=reversible)
 {set mkgmap:road-class=-2; set mkgmap:road-speed=-2; delete mkgmap:fast_road}

# convert some specific to generic with restrictions (platform is in a bus station)
#highway=steps | highway=corridor | highway=stepping_stones | highway=elevator | highway=escalator | highway=platform
 #{set highway=footway; add bicycle=no}
# virtual seems to be a way across a pedestrian area
highway=crossing | highway=virtual
 {set highway=path} # following logic may change

# Convert generic path to most specific
highway=path & (designation=permissive_bridleway | designation=public_bridleway)
 {set highway=bridleway; add foot=yes}
highway=path & (designation=permissive_footpath | designation=public_footpath)
 {set highway=footway; add foot=designated}
highway=path & snowplowing!=no & (bicycle=designated | bicycle=permissive | bicycle=official | cycleway=lane)
 {set highway=cycleway; add foot=yes}
highway=path & foot=designated
 {set highway=footway}


#highway=cycleway {name '${name} [cycleway]' | '[cycleway]'} [0x11 road_class=0 road_speed=1 resolution 23 default_name 'cycleway'] #0x11 linea negra delgada
if ( highway=cycleway ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [cycleway]' | '(sand) [cycleway]'} [0x16 road_class=0 road_speed=1 resolution 23]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [cycleway]' | '(gravel) [cycleway]'} [0x16 road_class=0 road_speed=1 resolution 23]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [cycleway]' | '(unp) [cycleway]'} [0x16 road_class=0 road_speed=1 resolution 23]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [cycleway]' | '(dirt) [cycleway]'} [0x16 road_class=0 road_speed=1 resolution 23]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [cycleway]' | '(compac) [cycleway]'} [0x16 road_class=0 road_speed=1 resolution 23]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [cycleway]' | '(ground) [cycleway]'} [0x16 road_class=0 road_speed=1 resolution 23]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [cycleway]' | '(unkn) [cycleway]'} [0x16 road_class=0 road_speed=1 resolution 23]
	surface=* {name '${name} (pav) [cycleway]' | '(pav) [cycleway]'} [0x16 road_class=0 road_speed=1 resolution 23]
end 

leisure=track & area!=yes {name '${name} (${sport}) [track]' | '${name} [track]' | '(${sport}) [track]' | '[track]'; addlabel '${phone}' | '${website}' | '${operator}'} 
	[0x10705 resolution 22-24]
man_made=pier | man_made=quay | man_made=groyn {name '${name} [pier]' | ' [pier]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x28 resolution 24]# might also have natural=water
man_made=storage_tank & content!=water 
	{name '${name} (${content}) [storage_tank]' | '(${content}) [storage_tank]' | '[storage_tank]' ; addlabel '${phone}' | '${website}' | '${operator}'} 
	[0x28 resolution 24]
dock=drydock | waterway=dock {add highway=footway; name '${ref} ${name}' | '${ref}' | '${name}'; addlabel '${phone}' | '${website}' | '${operator}'} [0x10705 resolution 24]

#sport=horse_racing | leisure=horse_riding {add name='${horse_raising|subst:"_=> "}'} [0x10705 resolution 24 default_name 'horse_racing']
sport=horse_racing | leisure=horse_riding {name '${name} [horse_racing]' | '[horse_racing]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10705 resolution 24]

man_made=breakwater & is_closed()=false & mkgmap:mp_created!=true 
	{name '${name} [breakwater]' | '[breakwater]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x17 resolution 22-24] #rompe olas

# Roundabouts
junction=roundabout & (highway=trunk | highway=trunk_link) [0x0c road_class=4 road_speed=2 resolution 24 continue]
junction=roundabout & (highway=trunk | highway=trunk_link) [0x10801 resolution 18]

junction=roundabout & (highway=primary | highway=primary_link) & mkgmap:fast_road=yes [0x0c road_class=4 road_speed=2 resolution 24 continue]
junction=roundabout & (highway=primary | highway=primary_link) & mkgmap:fast_road=yes [0x10802 resolution 19]

junction=roundabout & (highway=primary | highway=primary_link) [0x0c road_class=3 road_speed=2 resolution 24 continue]
junction=roundabout & (highway=primary | highway=primary_link) [0x10802 resolution 19]

junction=roundabout & (highway=secondary | highway=secondary_link) & mkgmap:fast_road=yes [0x0c road_class=3 road_speed=2 resolution 24 continue]
junction=roundabout & (highway=secondary | highway=secondary_link) & mkgmap:fast_road=yes [0x10803 resolution 20-24]

junction=roundabout & (highway=secondary | highway=secondary_link) [0x0c road_class=2 road_speed=2 resolution 24 continue]
junction=roundabout & (highway=secondary | highway=secondary_link) [0x10803 resolution 20-24]

junction=roundabout & (highway=tertiary | highway=tertiary_link) [0x0c road_class=1 road_speed=1 resolution 24 continue]
junction=roundabout & (highway=tertiary | highway=tertiary_link) [0x10804 resolution 21]

junction=roundabout & (highway=unclassified | highway=minor) [0x0c road_class=1 road_speed=1 resolution 21]
junction=roundabout & highway=* [0x0c road_class=0 road_speed=1 resolution 22-24]

# Ways that may or may not be useable

# Treat ways under construction almost as highway=path, see also extra rule in inc/access
highway=construction {add mkgmap:dead-end-check=false} [0x16 road_class=0 road_speed=0 resolution 23]

# Lower the road speed of ways under some construction.
highway=* & construction=* & maxspeed!=* {add mkgmap:road-speed='-1'}
# Lower the road speed of disused ways.
highway=* & disused=yes & maxspeed!=* {add mkgmap:road-speed='-2'}

# Ways sorted roughly by descending order of class
highway=motorway & mkgmap:fast_road=yes [0x01 road_class=4 road_speed=7 resolution 14]
highway=motorway [0x01 road_class=4 road_speed=7 resolution 15]
highway=motorway_link & (mkgmap:exit_hint=true | mkgmap:dest_hint=*) [0x0b road_class=4 road_speed=2 resolution 16]
highway=motorway_link [0x09 road_class=4 road_speed=2 resolution 16]

highway=trunk & mkgmap:fast_road=yes [0x02 road_class=4 road_speed=5 resolution 14]
highway=trunk [0x02 road_class=4 road_speed=5 resolution 18]
highway=trunk_link & (mkgmap:exit_hint=true | mkgmap:dest_hint=*) [0x0b road_class=4 road_speed=2 resolution 20-24]
highway=trunk_link [0x09 road_class=4 road_speed=2 resolution 20-24]
highway=* & motorroad=yes [0x02 road_class=4 road_speed=4 resolution 18]

highway=primary & mkgmap:fast_road=yes [0x03 road_class=4 road_speed=4 resolution 17]
highway=primary {name '${name} [primary]' | '[primary]'} [0x03 road_class=3 road_speed=4 resolution 18]

highway=primary_link & (mkgmap:exit_hint=true | mkgmap:dest_hint=*) & mkgmap:fast_road=yes 
	{name '${name} [primary_link]' | '[primary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x0b road_class=4 road_speed=1 resolution 18]
highway=primary_link & (mkgmap:exit_hint=true | mkgmap:dest_hint=*) 
	{name '${name} [primary_link]' | '[primary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x0b road_class=3 road_speed=1 resolution 18]
highway=primary_link & mkgmap:fast_road=yes 
	{name '${name} [primary_link]' | '[primary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x08 road_class=4 road_speed=1 resolution 18]
highway=primary_link  
	{name '${name} [primary_link]' | '[primary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x08 road_class=3 road_speed=1 resolution 18 default_name 'primary_link']

if ( highway=secondary ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [secondary]' | '(sand) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [secondary]' | '(gravel) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [secondary]' | '(unp) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name}(dirt) [secondary]' | '(dirt) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [secondary]' | '(compac) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [secondary]' | '(ground) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [secondary]' | '(unkn) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
end 
highway=secondary & mkgmap:fast_road=yes & (oneway!=no & oneway=*) 
{name '${name} (pav) (one_way) [secondary]' | '(pav) (one_way)  [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x04 road_class=3 road_speed=3 resolution 18]
highway=secondary & mkgmap:fast_road=yes {name '${name} (pav) [secondary]' | '(pav) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x04 road_class=3 road_speed=3 resolution 18]
highway=secondary & (oneway!=no & oneway=*) {name '${name} (pav) (one_way) [secondary]' | '(pav) (one_way) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x04 road_class=2 road_speed=3 resolution 18]
highway=secondary {name '${name} (pav) [secondary]' | '(pav) [secondary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x04 road_class=2 road_speed=3 resolution 18]
	
if ( highway=secondary_link ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [secondary_link]' | '(sand) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [secondary_link]' | '(gravel) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [secondary_link]' | '(unp) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name}(dirt) [secondary_link]' | '(dirt) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [secondary_link]' | '(compac) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [secondary_link]' | '(ground) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 	
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface!=* & (oneway!=no & oneway=*) {add mkgmap:unpaved=1 ; name '${name} (unkn) (one_way) [secondary_link]' | '(unkn) (one_way) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [secondary_link]' | '(unkn) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
end	
highway=secondary & mkgmap:fast_road=yes & (oneway!=no & oneway=*) 
	{name '${name} (pav) (one_way) [secondary_link]' | '(pav) (one_way)  [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x04 road_class=3 road_speed=3 resolution 18]
highway=secondary & mkgmap:fast_road=yes 
	{name '${name} (pav) [secondary_link]' | '(pav) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x04 road_class=3 road_speed=3 resolution 18]
highway=secondary & (oneway!=no & oneway=*) 
	{name '${name} (pav) (one_way) [secondary_link]' | '(pav) (one_way) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x04 road_class=2 road_speed=3 resolution 18]
highway=secondary 
	{name '${name} (pav) [secondary_link]' | '(pav) [secondary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x04 road_class=2 road_speed=3 resolution 18]

if ( highway=tertiary ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [tertiary]' | '(sand) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [tertiary]' | '(gravel) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [tertiary]' | '(unp) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name}(dirt) [tertiary]' | '(dirt) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [tertiary]' | '(compac) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [tertiary]' | '(ground) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface!=* & (oneway!=no & oneway=*) {add mkgmap:unpaved=1 ; name '${name} (unkn) (one_way) [tertiary]' | '(unkn) (one_way) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [tertiary]' | '(unkn) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=3 resolution 20-24]	
	surface=* & (oneway!=no & oneway=*) {name '${name} (pav) (one_way) [tertiary]' | '(pav) (one_way) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=1 resolution 18]
	surface=* {name '${name} (pav) [tertiary]' | '(pav) [tertiary]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x05 road_class=1 road_speed=1 resolution 18]
end 

highway=tertiary_link {name '${name} (pav) [tertiary_link]' | '(pav) [tertiary_link]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x08 road_class=1 road_speed=1 resolution 18]

if ( highway=unclassified | highway=minor ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [minor]' | '(sand) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 21]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [minor]' | '(gravel) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 21]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [minor]' | '(unp) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 21]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [minor]' | '(dirt) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 21]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [minor]' | '(compac) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 21]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [minor]' | '(ground) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 21]
	surface!=* & (oneway!=no & oneway=*) {add mkgmap:unpaved=1 ; name '${name} (unkn) (one_way) [minor]' | '(unkn) (one_way) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 21] 			#change resolution to find roads with no surface
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [minor]' | '(unkn) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 21] 			#change resolution to find roads with no surface
	surface=* & (oneway!=no & oneway=*) {name '${name} (pav) (one_way) [minor]' | '(pav) (one_way) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 20-24]
	surface=* {name '${name} (pav) [minor]' | '(pav) [minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} 
		[0x06 road_class=1 road_speed=3 resolution 20-24]
end 
( highway=unclassified | highway=minor ) {name '${name} [minor]' | '[minor]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}'} [0x06 road_class=1 road_speed=1 resolution 20-24 ]

#bridge ~ '(yes|boardwalk|cantilever|covered|low_water_crossing|movable|trestle|viaduct)' &
#	!(piste:type = * | building = * | railway = * | attraction = water_slide) &
#	!(area = yes | man_made = bridge | man_made = pier | mkgmap:mp_created = true) &
#	(highway ~ '(motorway|motorway_link|trunk|trunk_link|primary|primary_link|secondary|secondary_link|tertiary|tertiary_link|residential|service|unclassified|living_street|road|pedestrian)' | waterway = canal)
#	{name '${name} [bridge]'}
#	[0x29 resolution 24]
	#[0x2a resolution 24 continue with_actions]


#Bridge narrow
#bridge ~ '(yes|boardwalk|cantilever|covered|low_water_crossing|movable|trestle|viaduct)' &
#	!(piste:type = * | building = * | attraction = water_slide | man_made ~ '(bridge|pier)') &
#	!(area = yes | mkgmap:mp_created = true) &
#	(	highway ~ '(footway|bridleway|steps|cycleway|track|path)' | 
#		railway ~ '(rail|narrow_gauge|light_rail|tram)' |
#		waterway = stream
#	)
#	{name '${name} [bridge]'}
#	[0x29 resolution 24]
	#[0x2b resolution 24 continue with_actions]

#Tunnel narrow : just visual no routing
highway ~'(path|footway|bridleway|track|cycleway|steps)' &
	!(piste:type = * | building = * | service = parking_aisle | attraction = water_slide) &
	!(area = yes | jbmhighwayinpedestrian = true)
	{name '${name} [tunnel]'}
	[0x24 resolution 24 continue]

highway=yes {set highway=footway} # fix common bad tagging - little bits of path to join other routable ways

# Some countries allow, others disallow bicycling on pedestrian streets. See inc/access_country

# highway=pedestrian could be closed polygon to represent a 'square', add route regardless and continue for polygon processing
#highway=pedestrian {set tmp:stopMopUp=yes} [0x16 road_class=0 road_speed=0 resolution 22-24 continue with_actions]
if ( highway=pedestrian ) then
	surface=sand {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (sand) [pede]' | '(sand) [pede]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=gravel {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (gravel) [pede]' | '(gravel) [pede]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=unpaved {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (unp) [pede]' | '(unp) [pede]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=dirt {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (dirt) [pede]' | '(dirt) [pede]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=compacted {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (compac) [pede]' | '(compac) [pede]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=ground {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (ground) [pede]' | '(ground) [pede]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface!=* {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (unkn) [pede]' | '(unkn) [pede]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=* {set tmp:stopMopUp=yes ; name '${name} (pav) [pede]' | '(pav) [pede]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
end 

if ( highway=residential | highway=living_street) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [resi]' | '(sand) [resi]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} [0x06 road_class=0 road_speed=1 resolution 24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [resi]' | '(gravel) [resi]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} [0x06 road_class=0 road_speed=1 resolution 24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [resi]' | '(unp) [resi]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} [0x06 road_class=0 road_speed=1 resolution 24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [resi]' | '(dirt) [resi]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} [0x06 road_class=0 road_speed=1 resolution 24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [resi]' | '(compac) [resi]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} [0x06 road_class=0 road_speed=1 resolution 24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [resi]' | '(ground) [resi]' ; addlabel '${maxspeed} ${lanes}' | '${maxspeed}' | '${lanes}' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} [0x06 road_class=0 road_speed=1 resolution 24]
	surface!=* & (oneway!=no & oneway=*) {add mkgmap:unpaved=1 ; name '${name} (unkn) (one_way) [resi]' | '(unkn) (one_way) [resi]'  ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 	
		[0x06 road_class=0 road_speed=1 resolution 24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [resi]' | '(unkn) [resi]'  ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 24]
	surface=* & (oneway!=no & oneway=*) {name '${name} (pav) (one_way) [resi]' | '(pav) (one_way) [resi]'  ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 24]
	surface=* {name '${name} (pav) [resi]' | '(pav) [resi]'  ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 24]
end 
#highway=residential [0x12 road_class=0 road_speed=1 resolution 24 continue] # invisible routable line
#highway=residential [0x10600 resolution 24] #extended line showing arrow 

#highway=bridleway [0x07 road_class=0 road_speed=0 resolution 23 default_name 'bridleway'] #horse path
if ( highway=bridleway) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [bridleway]' | '(sand) [bridleway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 22-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [bridleway]' | '(gravel) [bridleway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 22-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [bridleway]' | '(unp) [bridleway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 22-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [bridleway]' | '(dirt) [bridleway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'}
		[0x07 road_class=0 road_speed=2 resolution 22-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [bridleway]' | '(compac) [bridleway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 22-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [bridleway]' | '(ground) [bridleway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 22-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [bridleway]' | '(unkn) [bridleway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 22-24]
	surface=* {name '${name} (pav) [bridleway]' | '(pav) [bridleway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 22-24]
end 

#highway=byway [0x16 road_class=0 road_speed=0 resolution 23 default_name 'byway'] #path?
if ( highway=byway) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [byway]' | '(sand) [byway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=2 resolution 22-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [byway]' | '(gravel) [byway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=2 resolution 22-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [byway]' | '(unp) [byway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=2 resolution 22-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [byway]' | '(dirt) [byway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=2 resolution 22-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [byway]' | '(compac) [byway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=2 resolution 22-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [byway]' | '(ground) [byway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=2 resolution 22-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [byway]' | '(unkn) [byway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=2 resolution 22-24]
	surface=* {name '${name} (pav) [byway]' | '(pav) [byway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=2 resolution 22-24]
end 

highway=driveway {set highway=service; add service=driveway} # fix common bad taggi
highway=access {set highway=service} # fix common bad tagging
highway=access_ramp {set highway=footway} # proposed

#highway=service & service=parking_aisle [0x07 road_class=0 road_speed=1 resolution 24]
#highway=service & (service=alley | service=driveway) [0x07 road_class=0 road_speed=0 resolution 23]
#highway=service [0x07 road_class=0 road_speed=2 resolution 22-24 default_name 'service_road']
if ( highway=service ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [${service}]' | '(sand) [${service}]' | '${name} (sand) [service]' | '(sand) [service]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [${service}]' | '(gravel) [${service}]' | '${name} (gravel) [service]' | '(gravel) [service]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [${service}]' | '(unp) [${service}]' | '${name} (unp) [service]' | '(unp) [service]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [${service}]' | '(dirt) [${service}]' | '${name} (dirt) [service]' | '(dirt) [service]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [${service}]' | '(compac) [${service}]' | '${name} (compac) [service]' | '(compac) [service]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [${service}]' | '(ground) [${service}]' | '${name} (ground) [service]' | '(ground) [service]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [${service}]' | '(unkn) [${service}]' | '${name} (unkn) [service]' | '(unkn) [service]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 24]
	surface=* {name '${name} (pav) [${service}]' | '(pav) [${service}]' | '${name} (pav) [service]' | '(pav) [service]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x07 road_class=0 road_speed=2 resolution 22-24]
end 


# highway=footway is often an area as well, continue for polygon processing
#highway=footway {set tmp:stopMopUp=yes} [0x16 road_class=0 road_speed=0 resolution 23 default_name 'footway' continue with_actions]
if ( highway=footway ) then
	surface=sand {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (sand) [footway]' | '(sand) [footway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=gravel {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (gravel) [footway]' | '(gravel) [footway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=unpaved {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (unp) [footway]' | '(unp) [footway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=dirt {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (dirt) [footway]' | '(dirt) [footway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=compacted {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (compac) [footway]' | '(compac) [footway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=ground {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (ground) [footway]' | '(ground) [footway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface!=* {set tmp:stopMopUp=yes ; add mkgmap:unpaved=1 ; name '${name} (unkn) [footway]' | '(unkn) [footway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
	surface=* {set tmp:stopMopUp=yes ; name '${name} [footway]' | '[footway]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=0 road_speed=0 resolution 22-24]
end 

#highway=trail {set highway=path; add bicycle=no} # fix common bad tagging
#highway=trail {set highway=path} 
if ( highway=trail ) then
	surface=sand {set highway=path; add mkgmap:unpaved=1 ; name '${name} (sand) [trail]' | '(sand) [trail]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=gravel {set highway=path; add mkgmap:unpaved=1 ; name '${name} (gravel) [trail]' | '(gravel) [trail]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=unpaved {set highway=path; add mkgmap:unpaved=1 ; name '${name} (unp) [trail]' | '(unp) [trail]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=dirt {set highway=path; add mkgmap:unpaved=1 ; name '${name} (dirt) [trail]' | '(dirt) [trail]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=compacted {set highway=path; add mkgmap:unpaved=1 ; name '${name} (compac) [trail]' | '(compac) [trail]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	urface=ground {set highway=path; add mkgmap:unpaved=1 ; name '${name} (ground) [trail]' | '(ground) [trail]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface!=* {set highway=path; add mkgmap:unpaved=1 ; name '${name} (unkn) [trail]' | '(unkn) [trail]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=* {set highway=path; name '${name} (pav) [trail]' | '(pav) [trail]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
end 

#highway=path [0x16 road_class=0 road_speed=0 resolution 23 default_name 'path'] 
if ( highway=path ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [path]' | '(sand) [path]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [path]' | '(gravel) [path]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [path]' | '(unp) [path]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [path]' | '(dirt) [path]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 	
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [path]' | '(compac) [path]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [path]' | '(ground) [path]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [path]' | '(unkn) [path]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=* {name '${name} (pav) [path]' | '(pav) [path]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
end 

#highway=track [0x0a road_class=0 road_speed=1 resolution 23 default_name 'track'] 
if ( highway=track ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [track]' | '(sand) [track]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [track]' | '(gravel) [track]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [track]' | '(unp) [track]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [track]' | '(dirt) [track]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [track]' | '(compac) [track]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	urface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [track]' | '(ground) [track]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [track]' | '(unkn) [track]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=* {name '${name} (pav) [track]' | '(pav) [track]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
end 

#highway=unsurfaced [0x0a road_class=0 road_speed=1 resolution 22-24]
if ( highway=unsurfaced ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [unsur]' | '(sand) [unsur]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [unsur]' | '(gravel) [unsur]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [unsur]' | '(unp) [unsur]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [unsur]' | '(dirt) [unsur]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [unsur]' | '(compac) [unsur]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [unsur]' | '(ground) [unsur]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [unsur]' | '(unkn) [unsur]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
	surface=* {name '${name} (pav) [unsur]' | '(pav) [unsur]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x0a road_class=1 road_speed=1 resolution 22-24]
end 

#highway=road {add mkgmap:dead-end-check=false} [0x06 road_class=0 road_speed=1 resolution 22-24]
if ( highway=road ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [road]' | '(sand) [road]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 22-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [road]' | '(gravel) [road]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 22-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [road]' | '(unp) [road]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 22-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [road]' | '(dirt) [road]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 22-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [road]' | '(compac) [road]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 22-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [road]' | '(ground) [road]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 22-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [road]' | '(unkn) [road]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 22-24]
	surface=* {name '${name} (pav) [road]' | '(pav) [road]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x06 road_class=0 road_speed=1 resolution 22-24]
end 

#man_made=embankment | man_made=levee [0x10101 resolution 22-24 default_name 'embankment']
if ( man_made=embankment | man_made=levee) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [embank]' | '(sand) [embank]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x10101 resolution 22-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [embank]' | '(gravel) [embank]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x10101 resolution 22-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [embank]' | '(unp) [embank]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x10101 resolution 22-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [embank]' | '(dirt) [embank]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x10101 resolution 22-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [embank]' | '(compac) [embank]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x10101 resolution 22-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [embank]' | '(ground) [embank]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x10101 resolution 22-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [embank]' | '(unkn) [embank]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x10101 resolution 22-24]
	surface=* {name '${name} (pav) [embank]' | '(pav) [embank]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x10101 resolution 22-24]
end 

# handle some rarer bits of road. Do just in case joining paths or bits of one-way roads
highway=turning_loop | highway=turning_circle | highway=layby | highway=escape | highway=emergency_bay
 [0x07 road_class=0 road_speed=0 resolution 24]

# These are too specialized to have routing, so shouldn't drop into the mop-up, but, maybe needing TYP, can be shown on the map
#highway=raceway | highway=gallop {add name='${highway}'} [0x30 resolution 23]
#highway=raceway | highway=gallop {add name='${highway}'} [0x1c resolution 23]
#highway=raceway | highway=gallop | sport=motor {add name='${raceway|subst:"_=> "}'} [0x10705 resolution 23 default_name 'raceway'] # brown line
highway=raceway {name '${name} [raceway]' | '[raceway]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10705 resolution 23] # brown line
highway=gallop {name '${name} [${sport}]' | '[${sport}]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10705 resolution 23] # brown line
#highway=raceway | highway=gallop {add name='${highway}'} [0x23 resolution 23] #blue line
#highway=raceway | highway=gallop {add name='${highway}'} [0x0a resolution 23] #dotter wide lane


# Don't have routable for either of these:
# most 'rest_area' don't connect to the main road
# 'services' is normally a big area that covers the whole complex
highway=rest_area | highway=services {set tmp:stopMopUp=yes}


if ( highway=* ) then
	surface=sand {add mkgmap:unpaved=1 ; name '${name} (sand) [${highway}]' | '(sand) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=gravel {add mkgmap:unpaved=1 ; name '${name} (gravel) [${highway}]' | '(gravel) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=unpaved {add mkgmap:unpaved=1 ; name '${name} (unp) [${highway}]' | '(unp) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=dirt {add mkgmap:unpaved=1 ; name '${name} (dirt) [${highway}]' | '(dirt) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=compacted {add mkgmap:unpaved=1 ; name '${name} (compac) [${highway}]' | '(compac) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=ground {add mkgmap:unpaved=1 ; name '${name} (ground) [${highway}]' | '(ground) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface!=* {add mkgmap:unpaved=1 ; name '${name} (unkn) [${highway}]' | '(unkn) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
	surface=* {name '${name} (pav) [${highway}]' | '(pav) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
		[0x16 road_class=1 road_speed=0 resolution 22-24]
end 

# Mop up any unrecognised highway types
#highway=* & tmp:stopMopUp!=yes {echotags 'mop-up highway'} # mostly actual road names
# It is considered best not to process unrecognised highway types
#highway=* & area!=yes & tmp:stopMopUp!=yes [0x07 road_class=0 road_speed=0 resolution 23]

# Showing the coastline adds almost nothing visuals of the map, so it's disabled:
natural=coastline {name '${name} [coastline]' | '[coastline]'; addlabel '${phone}' | '${website}' | '${operator}'} [0x15 resolution 12]

power=line 
	{name '${name} (${voltage}v) (${cables}) [powerline]' | 
	'${name} (${cables}) [powerline]' |
	'${name} (${voltage}v) [powerline]' |
	'${name} [powerline]' |
	'(${voltage}v) (${cables}) [powerline]' |
	'(${cables}) [powerline]' |
	'(${voltage}v) [powerline]' |
	'[powerline]' ; addlabel '${phone}' | '${website}' | '${operator}'}  [0x29 resolution 21]
power=minor_line 
	{name '${name} (${voltage}v) (${cables}) [minor_power]' | 
	'${name} (${cables}) [minor_power]' |
	'${name} (${voltage}v) [minor_power]' |
	'${name} [minor_power]' |
	'(${voltage}v) (${cables}) [minor_power]' |
	'(${cables}) [minor_power]' |
	'(${voltage}v) [minor_power]' |
	'[minor_power]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x29 resolution 24]

railway=platform & tmp:stopMopUp!=yes [0x16 road_class=0 road_speed=0 resolution 23]
# Railway lines, note that many devices display type 0x14 only at resolution 24
(railway=rail | railway=tram | railway=subway | railway=narrow_gauge | railway=light_rail | railway=preserved) & !(tunnel=yes)
 {name '${name} (${railway}) (${usage}) [railway]' | 
 '${name} (${usage}) [railway]' | 
 '${name} (${railway}) [railway]' | 
 '${name} [railway]' | 
 '(${railway}) [railway]' | 
 '(${usage}) [railway]' | 
 '[railway]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x14 resolution 22-24]
(railway=rail | railway=tram | railway=disused | railway=subway | railway=narrow_gauge | railway=light_rail | railway=preserved) & (tunnel=yes)
 {name '${name} (tunnel) [railway]'} [0x14 resolution 22-24]
railway=abandoned | railway=disused {name '${name} (abandoned) [railway]' | '(abandoned) [railway]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x14 resolution 22-24]

man_made=pipeline & location=underground 
	{name '${name} (underground) (${diameter}) [pipeline]' | '${name} (underground) [pipeline]' | '(underground) (${diameter}) [pipeline]' | '(underground) [pipeline]' ; 
		addlabel '${substance} ${operator}' |  '${substance}' | '${operator}'} [0x28 resolution 22-24]
man_made=pipeline & location=underground 
	{name '${name} (underground) [pipeline]' | '(underground) [pipeline]' ; 
	addlabel '${substance} ${operator}' |  '${substance}' | '${operator}'} [0x28 resolution 22-24]
man_made=pipeline 
	{name '${name} (${diameter}) [pipeline]' | '${name} [pipeline]' | '(${diameter}) [pipeline]' | '[pipeline]' ; 
	addlabel '${substance} ${operator}' |  '${substance}' | '${operator}'} [0x28 resolution 22-24]
man_made=pipeline {name '${name} [pipeline]' | '[pipeline]' ; addlabel '${substance} ${operator}' |  '${substance}' | '${operator}'} [0x28 resolution 22-24]

man_made=cable & location=underground 
	{name '${name} (${operator}) (underground) [cable]' | '${name} (underground) [cable]' | '${operator} (undergr8ound) [cable]' | '(underground) [cable]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x28 resolution 22-24]
(man_made=cable | (man_made=* & man_made~'.*pipe.*')) & area!=yes & tunnel!=yes & location!=underground
	{name '${name} (${operator}) [cable]' | '${name} [cable]' | '${operator} [cable]' | '[cable]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x28 resolution 23]

#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x17 resolution 24]
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10a15 resolution 24] #blue line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10a16 resolution 24] #blue line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10916 resolution 24] #brown line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10905 resolution 24] #blue line
#0x10705 brown line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10605 resolution 24] #blue line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch | barrier=yes {add name='${barrier|subst:"_=> "}'} [0x10503 resolution 24 default_name 'barrier'] #pink line <----
barrier=* & power=* {delete barrier}  # some power areas are marked with both
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch | barrier=* {name '${barrier} [barrier]' | '[barrier]' ; addlabel '${operator}'} [0x10503 resolution 24] #pink line <----
barrier=* {name '(${barrier}) [barrier]' | '[barrier]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10503 resolution 24] #pink line <----
#barrier=* & ( barrier!=toll_booth | barrier!=border_control ) {name '(${barrier}) [barrier]' | '[barrier]' ; addlabel '${operator}'} [0x10503 resolution 24] #pink line <----
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10403 resolution 24] #black line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10703 resolution 24] #grey line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10505 resolution 24] #pink line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10a13 resolution 24] #blue line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10a11 resolution 24] #blue line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10a10 resolution 24] #blue line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10a08 resolution 24] #blue line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10303 resolution 24] #blue line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10101 resolution 24] #grey line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x10805 resolution 24] #bold white line
#barrier=wall | barrier=fence | barrier=hedge | barrier=ditch {add name='${barrier|subst:"_=> "}'} [0x1c resolution 24] #administrive black line

route=ferry & (toll=no | toll=false) {set mkgmap:toll=no}
route=ferry {set mkgmap:numbers=false; set mkgmap:ferry=1; add mkgmap:toll=yes}
route=ferry & (motorcar=no | motor_vehicle=no) {name '${name} [ferry_no_motor]' | '[ferry_no_motor]' ; addlabel '${phone}' | '${website}' | '${operator}'} 
	[0x1b road_class=0 road_speed=0 resolution 23]
route=ferry {name '${name} [ferry]' | '[ferry]' ; addlabel '${phone}' | '${website}' | '${operator}' ; addlabel '${phone}' | '${website}' | '${operator}'} 
	[0x1a road_class=3 road_speed=0 resolution 19]

(waterway=river | waterway=stream | waterway=rapids | waterway=waterfall) {add mkgmap:has-direction=true}

waterway=river & intermittent=yes 
	{name '${name} {${old_name}} (interm) (${width}) [river]' | '${name} {${old_name}} (interm) (${width}) [river]' | '${name} (interm) (${width}) [river]' |  '${name} (interm) [river]' | '(interm) (${width}) [river]' |  '(interm) [river]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x1f resolution 20-24] 
waterway=river & intermittent=no 
	{name '${name} {${old_name}} (perm) (${width}) [river]' | '${name} {${old_name}} (perm) (${width}) [river]' | '${name} (perm) (${width}) [river]' | '${name} (perm) [river]' | '(perm) (${width}) [river]' | '(perm) [river]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x1f resolution 18] # 0x1f river
waterway=river 
	{name '${name} {${old_name}} (unkn) (${width}) [river]' | '${name} {${old_name}} (unkn) (${width}) [river]' | '${name} (unkn) (${width}) [river]' | '${name} (unkn) [river]' | '(unkn) (${width}) [river]' | '(unkn) [river]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x1f resolution 18] #continuous

waterway=canal & intermittent=yes 
	{name '${name} 
	{${old_name}} (interm) (${width}) (${usage}) [canal]' | '${name} {${old_name}} (interm) (${width}) [canal]' | '${name} {${old_name}} (interm) (${usage}) [canal]' | '${name} {${old_name}} (interm)  [canal]' |
	'${name} (interm) (${width}) (${usage}) [canal]' | '${name} (interm) (${width}) [canal]' | '${name} (interm) (${usage}) [canal]' | '${name} (interm) [canal]' | 
	'(interm) (${width}) (${usage}) [canal]' | '(interm) (${width}) [canal]' | '(interm) (${usage}) [canal]' | '(interm) [canal]' ; 
	addlabel '${phone}' | '${website}' | '${operator}'} [0x26 resolution 22-24] 
waterway=canal & intermittent=no 
	{name '${name} 
	{${old_name}} (perm) (${width}) (${usage}) [canal]' | '${name} {${old_name}} (perm) (${width}) [canal]' | '${name} {${old_name}} (perm) (${usage}) [canal]' | '${name} {${old_name}} (perm)  [canal]' |
	'${name} (perm) (${width}) (${usage}) [canal]' | '${name} (perm) (${width}) [canal]' | '${name} (perm) (${usage}) [canal]' | '${name} (perm) [canal]' | 
	'(perm) (${width}) (${usage}) [canal]' | '(perm) (${width}) [canal]' | '(perm) (${usage}) [canal]' | '(perm) [canal]' ; 
	addlabel '${phone}' | '${website}' | '${operator}'} [0x18 resolution 22-24] 
waterway=canal 
	{name '${name} 
	{${old_name}} (unkn) (${width}) (${usage}) [canal]' | '${name} {${old_name}} (unkn) (${width}) [canal]' | '${name} {${old_name}} (unkn) (${usage}) [canal]' | '${name} {${old_name}} (unkn)  [canal]' |
	'${name} (unkn) (${width}) (${usage}) [canal]' | '${name} (unkn) (${width}) [canal]' | '${name} (unkn) (${usage}) [canal]' | '${name} (unkn) [canal]' | 
	'(unkn) (${width}) (${usage}) [canal]' | '(unkn) (${width}) [canal]' | '(unkn) (${usage}) [canal]' | '(unkn) [canal]' ; 
	addlabel '${phone}' | '${website}' | '${operator}'} [0x18 resolution 22-24] 
	
waterway=ditch & intermittent=yes 
	{name '${name} {${old_name}} (interm) (${width}) [ditch]' | '${name} {${old_name}} (interm) (${width}) [ditch]' | '${name} (interm) (${width}) [ditch]' | '${name} (interm) [ditch]' | '(interm) (${width}) [ditch]' | '(interm) [ditch]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x26 resolution 22-24] 
waterway=ditch & intermittent=no 
	{name '${name} {${old_name}} (perm) (${width}) [ditch]' | '${name} {${old_name}} (perm) (${width}) [ditch]' | '${name} (interm) (${width}) [ditch]' | '${name} (perm) [ditch]' | '(perm) (${width}) [ditch]' | '(perm) [ditch]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x18 resolution 20-24]
waterway=ditch 
	{name '${name} {${old_name}} (unkn) (${width}) [ditch]' | '${name} {${old_name}} (unkn) (${width}) [ditch]' | '${name} (unkn) (${width}) [ditch]' | '${name} (unkn) [ditch]' | '(unkn) (${width}) [ditch]' | '(unkn) [ditch]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x18 resolution 22-24]

waterway=stream & intermittent=yes 
	{name '${name} {${old_name}} (interm) (${width}) [stream]' | '${name} {${old_name}} (interm) (${width}) [stream]' | '${name} (interm) (${width}) [stream]' |  '${name} (interm) [stream]' | '(interm) (${width}) [stream]' | '(interm) [stream]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x26 resolution 21] # 0x26 intermittent dotted
waterway=stream & intermittent=no 
	{name '${name} {${old_name}} (perm) (${width}) [stream]' | '${name} {${old_name}} (perm) (${width}) [stream]' | '${name} (perm) (${width}) [stream]' | '${name} (perm) [stream]' | '(perm) (${width}) [stream]' | '(perm) [stream]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x18 resolution 19] # 0x18 stream
waterway=stream 
	{name '${name} {${old_name}} (unkn) (${width}) [stream]' | '${name} {${old_name}} (unkn) (${width}) [stream]' | '${name} (unkn) (${width}) [stream]' | '${name} (unkn) [stream]' | '(unkn) (${width}) [stream]' | '(unkn) [stream]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x18 resolution 21]
	
natural=water & intermittent=yes & area!=yes& is_closed()=false
	{name '${name} {${old_name}} (interm) [water]' | '${name} {${alt_name}} (interm) [water]' | '${name} (interm) [water]' | '(interm) [water]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x26 resolution 21] # 0x26 intermittent dotted
natural=water & intermittent=no & area!=yes& is_closed()=false
	{name '${name} {${old_name}} (perm) [water]' | '${name} {${alt_name}} (perm) [water]' | '${name} (perm) [water]' | '(perm) [water]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x18 resolution 19] # 0x18 stream
natural=water & area!=yes& is_closed()=false
	{name '${name} {${old_name}} (unkn) [water]' | '${name} {${alt_name}} (unkn) [water]' | '${name} (unkn) [water]' |'(unkn) [water]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x18 resolution 21]


waterway=drain & intermittent=yes {name '${name} (interm) [drain]' | '(interm) [drain]'} [0x26 resolution 22-24] # 0x26 intermittent dotted
waterway=drain & intermittent=no {name '${name} (perm) [drain]' | '(perm) [drain]'} [0x18 resolution 20-24] # 0x18 stream
waterway=drain {name '${name} (unkn) [drain]' | '(unkn) [drain]'} [0x18 resolution 24]

# The following boundary styles are after the highway rules because ways
# are frequently tagged with both and we want the highway to take priority.
#boundary=administrative {name '${mkgmap:boundary_name}'}
#boundary=administrative & admin_level<3 [0x1e resolution 12]
#boundary=administrative & admin_level<5 [0x1d resolution 19]
#boundary=administrative & admin_level<7 [0x1c resolution 21]
#boundary=administrative & admin_level<9 [0x1c resolution 22]
#boundary=administrative [0x1c resolution 22]
#boundary=national [0x1e resolution 17]
#boundary=political [0x1c resolution 19]

boundary=administrative & admin_level<3 {name '${mkgmap:boundary_name} [nat_boundary]' | '[nat_boundary]' ; addlabel '${admin_level}' } [0x1e resolution 12]
#boundary=administrative & admin_level<5 {name '${mkgmap:boundary_name} [st_boundary]' | '[st_boundary]'}  [0x1d resolution 19]
boundary=administrative & admin_level<3 {name '${name} [nat_boundary]' | '[nat_boundary]' ; addlabel '${admin_level}' } [0x1e resolution 12]
#boundary=administrative & admin_level<5 {name '${name} [st_boundary]' | '[st_boundary]'}  [0x1d resolution 19]
boundary=administrative & admin_level<5 {name '${name} [st_boundary]' | '[st_boundary]' ; addlabel '${admin_level}' } [0x1d resolution 19]
boundary=administrative & admin_level<7 {name '${name} [ct_boundary]' | '[ct_boundary]' ; addlabel '${admin_level}' } [0x1c resolution 21]
boundary=administrative & admin_level<9 {name '${mkgmap:boundary_name} [boundary]' | '[boundary]' ; addlabel '${admin_level}' } [0x1c resolution 22-24]
#boundary=administrative {name '${mkgmap:boundary_name} [boundary]' | '[boundary]' ; addlabel '${admin_level}' } [0x1c resolution 24]
boundary=administrative {name '${name} [boundary]' | '[boundary]' ; addlabel '${admin_level}' } [0x1c resolution 24]
#boundary=national {name '${mkgmap:boundary_name} [nat_boundary]' | '[nat_boundary]' ; addlabel '${admin_level}' }[0x1e resolution 17]
boundary=national {name '${name} [nat_boundary]' | '[nat_boundary]' ; addlabel '${admin_level}' }[0x1e resolution 17]
#boundary=political {name '${mkgmap:boundary_name} [pol_boundary]' | '[pol_boundary]' ; addlabel '${admin_level}' }[0x1c resolution 19]
boundary=political {name '${name} [pol_boundary]' | '[pol_boundary]' ; addlabel '${admin_level}' }[0x1c resolution 19]

boundary=region & name='Continental Divide' {name '${name} [trail]' | '[trail]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x1c resolution 22-24] #gray admin line
#boundary=* {name '${mkgmap:boundary_name} (${boundary}) [ot_boundary]' | '[ot_boundary]' } [0x1c resolution 22]
# 0x01 orange line routable
# 0x12 black line routable - not visible gps

#natural=water & name='Laguna de Mayrán' [0x1d resolution 22-24] #***
#natural=water & name='Laguna de Viesca' [0x1d resolution 22-24] 
#natural=cliff [0x10a14 resolution 24 default_name 'cliff'] #blue line
#natural=cliff [0x10a12 resolution 24 default_name 'cliff'] #blue line
#natural=cliff [0x10a09 resolution 24 default_name 'cliff'] #blue line
#natural=cliff [0x10a07 resolution 24 default_name 'cliff'] #blue line
#natural=cliff [0x10207 resolution 24 default_name 'cliff'] #blue line
#natural=cliff [0x10b03 resolution 24 default_name 'cliff'] #blue line
#natural=cliff [0x10103 resolution 24 default_name 'cliff'] #black line
natural=cliff {name '${name} (${height}) [cliff]' | '${name} [cliff]' | '(${height}) [cliff]' | '[cliff]' ; addlabel '${height} ${operator}' | '${operator}' | '${height}'} [0x10503 resolution 24] 
natural=ridge {name '${name} (${height}) [ridge]' | '${name} [ridge]' | '(${height}) [ridge]' | '[ridge]' ; addlabel '${height} ${operator}' | '${operator}' | '${height}'} [0x10503 resolution 18]
natural=mountain_range 
	{name '${name} (${height}) [mountain_range]' | '${name} [mountain_range]' | '(${height}) [mountain_range]' | '[mountain_range]' ; addlabel '${height} ${operator}' | '${operator}' | '${height}'} 
	[0x10503 resolution 18]
natural=valley {name '${name} (${height}) [valley]' | '${name} [valley]' | '(${height}) [valley]' | '[valley]' ; addlabel '${height} ${operator}' | '${operator}' | '${height}'}  [0x10503 resolution 18] # ????
natural=arete 
	{name '${name} (${height}) [peaked_ridges]' | '${name} [peaked_ridges]' | '(${height}) [peaked_ridges]' |  '[peaked_ridges]' ; addlabel '${height} ${operator}' | '${operator}' | '${height}'} 
	[0x10503 resolution 24] #peaked ridges
natural=gorge | natural=canyon 
	{name '${name} (${height}) [canyon]' | '${name} [canyon]' | '(${height}) [canyon]' | '[canyon]' ; addlabel '${height} ${operator}' | '${operator}' | '${height}'} [0x26 resolution 22-24]
natural=tree_row {name '${name} [tree_row]' | '[tree_row]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10503 resolution 24]
natural=* & area=no {name '${name} [${natural}]' | '[${natural}]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x10503 resolution 24]


waterway=rapids {name '${name} [rapids]' | '[rapids]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x1f resolution 22-24]
waterway=waterfall {name '${name} (${height}) [waterfall]' | '${name} [waterfall]' | '[waterfall]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x1f resolution 22-24]
waterway=dam | man_made=dam 
	{name '${name} (${material}) [dam]' | '${name} [dam]' | '(${material}) [dam]' | '[dam]' ; addlabel '${height} ${operator}' | '${operator}' | '${height}'} [0x10503 resolution 22-24]
waterway=lock_gate | waterway=weir {name '${name} [lock_gate]' | '[lock_gate]' ; addlabel '${operator}'} [0x10503 resolution 24] # Weir is a barrier built across a river to control water speed and depth.

waterway=* & intermittent=yes & area!=yes & waterway!=no & is_closed()=false
	{name '${name} {${old_name}} (interm) (${width}) [${waterway]]' | '${name} {${alt_name}} (interm) (${width}) [${waterway]]' | '${name} (interm) (${width}) [${waterway]]' |  '${name} (interm) [${waterway]]' | '(interm) (${width}) [${waterway}]' | '(interm) [${waterway]]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x18 resolution 21] # 0x26 intermittent dotted
waterway=* & intermittent=no & area!=yes & waterway!=no & is_closed()=false
	{name '${name} {${old_name}} (perm) (${width}) [${waterway]]' | '${name} {${alt_name}} (perm) (${width}) [${waterway]]' | '${name} (perm) (${width}) [${waterway]]' | '${name} (perm) [${waterway]]' | '(perm) (${width}) [${waterway]]' | '(perm) [${waterway}]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x18 resolution 19] # 0x18 stream
waterway=* & area!=yes & waterway!=no & is_closed()=false
	{name '${name} {${old_name}} (unkn) (${width}) [${waterway]]' | '${name} {${alt_name}} (unkn) (${width}) [${waterway]]' | '${name} (unkn) (${width}) [${waterway]]' | '${name} (unkn) [${waterway]]' | '(unkn) (${width}) [${waterway]]' | '(unkn) [${waterway}]' ; addlabel '${width}' | '${phone}' | '${website}' | '${operator}'} 
	[0x18 resolution 21]


# mop up any remaining water lines
waterway=* & waterway!=no & (area=no | (is_closed()=false & mkgmap:mp_created!=true))
	{add name='${waterway|subst:"_=> "}'} [0x26 resolution 24]

include 'inc/contour_lines';

#boundary=* {name '${name} (${boundary}) [boundary]' | '(${boundary}) [boundary]' ; addlabel '${admin_level}'} [0x1c resolution 24 continue]
#abandoned=* {name '${name} (abandoned)  [${abandoned}]' | '(abandoned)  [${abandoned}]'} [0x1c resolution 24 continue]
hazard=* {name '${name} (${hazard) [hazard]' | ' (${hazard) [hazard]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x1c resolution 24]
abandoned=* & abandoned!=no [0x1c resolution 24 continue]
name=* & (area=no | (is_closed()=false & mkgmap:mp_created!=true)) {name '${name}'} [0x1c resolution 24 continue]
highway=* & is_closed()=false {name '${name} (unkn) [${highway}]' | '(unkn) [${highway}]' ; addlabel '${access} ${incline}' | '${access}' | '${incline}'} 
	[0x16 road_class=0 road_speed=0 resolution 22-24]
route=* {name '${name} (${route}) [route]' | '(${route}) [route]' ; addlabel '${phone}' | '${website}' | '${operator}' ; addlabel '${phone}' | '${website}' | '${operator}'} 
	[0x10805 resolution 24]
power=* {name '${name} [${power}]' | '[${power}]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x29 resolution 24]
man_made=* & is_closed()=false {name '${name} [${man_made}]' | '[${man_made}]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x28 resolution 22-24]
railway=* {name '${name} [{$railway}]' |  '[{$railway}]' ; addlabel '${phone}' | '${website}' | '${operator}'} [0x14 resolution 22-24]

<finalize>
# The finalizer section is executed for each element when a rule with an element type matches

include 'inc/address';
# calculate the road speed based on maxspeed tag
include 'inc/roadspeed';
# calculate the access rules
include 'inc/access';
 
#limit artificial cycleways to resolution 24
mkgmap:synthesised=yes & mkgmap:bicycle=yes {set mkgmap:highest-resolution-only=true}

# don't add house numbers to unnamed or artifical bicycle ways
mkgmap:bicycle=yes & (mkgmap:foot=no & mkgmap:car=no & mkgmap:street!=* | mkgmap:synthesised=yes) {set mkgmap:numbers=false}

# Display highway shield for mayor roads if they have a ref and make them searchable by their name
(highway=motorway | highway=trunk) & ref=* {name '${ref|highway-symbol:hbox}'; addlabel '${name}'}
highway=primary & ref=* {name '${ref|highway-symbol:box}' ; addlabel '${name}'}
(highway=secondary | highway=tertiary) & ref=* {name '${ref|highway-symbol:oval}'; addlabel '${name}'}

#highway=* & ref=* & highway!=motorway & highway!=trunk & highway!=primary & highway!=secondary & highway!=tertiary
#highway=*  {addlabel '${ref}'}

highway=* & int_ref=* {addlabel '${int_ref}'}
highway=* & nat_ref=* {addlabel '${nat_ref}'}
highway=* & reg_ref=* {addlabel '${reg_ref}'}
